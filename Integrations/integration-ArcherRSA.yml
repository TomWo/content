commonfields:
  id: RSA Archer
  version: -1
name: RSA Archer
display: RSA Archer
category: IT Services
image: data:image/png;base64,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
description: The RSA Archer GRC Platform provides a common foundation for managing
  policies, controls, risks, assessments and deficiencies across lines of business.
configuration:
- display: Server URL (e.g. https://192.168.0.1/rsaarcher/)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Instance name
  name: instanceName
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Do not validate server certificate (insecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: 'Date field name for fetch (en-US format: 07/22/2016 3:58 PM)'
  name: fetchByField
  defaultvalue: Date Created
  type: 0
  required: false
- display: Fields for fetch (comma separated)
  name: fetchFields
  defaultvalue: Title,Incident ID
  type: 0
  required: false
- display: Timezone offset in minutes of the RSA Archer server machine (+60, -60,
    in minutes)
  name: timeZone
  defaultvalue: ""
  type: 0
  required: false
- display: Application ID for fetch
  name: fetchApplicationId
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |-
    var server = params.server.replace(/[\/]+$/, '');
    var commands = {
      createRecord:     'archer-create-record',
      updateRecord:     'archer-update-record',
      getRecord:        'archer-get-record',
      searchApps:       'archer-search-applications',
      searchRecords:    'archer-search-records',
      getAppFields:     'archer-get-application-fields',
      deleteRecord:     'archer-delete-record',
      valueListForField: 'archer-value-list-for-field',
      fetchIncidents: 'archer-fetch-incidents',
      getReports: 'archer-get-reports',
      executeStatisticSearchByReport: 'archer-execute-statistic-search-by-report',
      getSearchOptionsByGuid: 'archer-get-search-options-by-guid',
      searchRecordsByReport: 'archer-search-records-by-report',
    };
    var urlDictionary = {};
    urlDictionary.login = '/ws/general.asmx';
    urlDictionary.logout = '/ws/general.asmx';
    urlDictionary.levelIdByModuleId = '/api/core/system/level/module/%applicationId%';
    urlDictionary.fieldByLevelId = '/api/core/system/fielddefinition/level/%levelId%';
    urlDictionary[commands.createRecord] = '/ws/record.asmx';
    urlDictionary[commands.updateRecord] = '/ws/record.asmx';
    urlDictionary[commands.getRecord] = '/ws/record.asmx';
    urlDictionary[commands.searchApps] = '/api/core/system/application';
    urlDictionary[commands.searchRecords] = '/ws/search.asmx';
    urlDictionary[commands.deleteRecord] = '/ws/record.asmx';
    urlDictionary[commands.valueListForField] = '/ws/field.asmx';
    urlDictionary[commands.getReports] = '/ws/search.asmx';
    urlDictionary[commands.executeStatisticSearchByReport] = '/ws/search.asmx';
    urlDictionary[commands.getSearchOptionsByGuid] = '/ws/search.asmx';
    urlDictionary[commands.searchRecordsByReport] = '/ws/search.asmx';
    var methodDictionary = {};
    methodDictionary.login = 'POST';
    methodDictionary.logout = 'POST';
    methodDictionary.levelIdByModuleId = 'POST';
    methodDictionary.fieldByLevelId = 'POST';
    methodDictionary[commands.createRecord] = 'POST';
    methodDictionary[commands.updateRecord] = 'POST';
    methodDictionary[commands.getRecord] = 'POST';
    methodDictionary[commands.searchApps] = 'POST';
    methodDictionary[commands.searchRecords] = 'POST';
    methodDictionary[commands.deleteRecord] = 'POST';
    methodDictionary[commands.valueListForField] = 'POST';
    methodDictionary[commands.getReports] = 'POST';
    methodDictionary[commands.executeStatisticSearchByReport] = 'POST';
    methodDictionary[commands.getSearchOptionsByGuid] = 'POST';
    methodDictionary[commands.searchRecordsByReport] = 'POST';
    function extractObjectFromXML(xml, path) {
        var searchRes = dq(xml, path);
        if (searchRes === "" || searchRes === null){
            return [];
        }
        if (searchRes.indexOf("<?xml") > -1) {
            var index = searchRes.indexOf(">");
            if (index !== -1) {
                searchRes = searchRes.substr(index + 1);
            }
        }
        return JSON.parse(x2j(searchRes));
    }
    function parseRecordsXml(token, response, mapping) {
        var parsedJson = extractObjectFromXML(response, 'Envelope.Body.ExecuteSearchResponse.ExecuteSearchResult');
        var records = dq(parsedJson, 'Records.Record');
        if (!records) {
            return [];
        }
        var mapping = mapping;
        var outputs =[];
        records = varifyOrMakeArray(records);
        records.forEach(function (record) {
            // iterating over all of the records
            var contentId = record['-contentId'];
            var moduleId = record['-moduleId'];
            var toContext = {
                Id: contentId,
                ModuleId: moduleId,
                Fields: {}
            };
            // used later on to check if we need to bring more mappings
            var seenModuleIds = {};
            seenModuleIds[moduleId] = moduleId;
            var fields = varifyOrMakeArray(record.Field);
            args.contentId = contentId;
            args.applicationId = moduleId;
            // Getting top level record and iterating over it to get the linked records
            var recordObject = getRecord(commands.getRecord, token, null, contentId, moduleId).keyValsForFetch;
            toContext.Fields.Record = recordObject;
            var innerRecords = varifyOrMakeArray(recordObject.innerRecords); // contains all possible inner fields
            innerRecords.forEach(function (innerRecord){
                if (innerRecord){
                    var innerRecordContentId = innerRecord.contentId;
                    var innerRecordModuleId = innerRecord.ModuleId || args.applicationId;
                    args.contentId = innerRecordContentId;
                    if(innerRecordModuleId && !(innerRecordModuleId in seenModuleIds)){
                        var newModuleId = innerRecordModuleId;
                        args.applicationId = newModuleId;
                        var newMapping = createMapping(token);
                        for (var attrname in newMapping) { 
                            mapping[attrname] = newMapping[attrname]; 
                        }
                        seenModuleIds[newModuleId] = newModuleId;
                    }
                    innerRecord.Record = getRecord(commands.getRecord, token, mapping, innerRecordContentId, innerRecordModuleId).keyValsForFetch;
                }
            });
            fields.forEach(function (field) {
                toContext.Fields[mapping[field['-id']].Name] = field['#text'];
            });
            outputs.push(toContext);
        });
        return outputs;
    }
    function soapRequestSender(cmd, bodyContent, SOAPAction) {
        var headers = {'Content-Type': ['text/xml; charset=utf-8']};
        if (SOAPAction) {
            headers.SOAPAction = [SOAPAction];
        }
        var url =  server +  urlDictionary[cmd];
        var result = http(
            url,
            {
                Method: methodDictionary[cmd],
                Headers: headers,
                Body: bodyContent
            },
            params.insecure,
            params.proxy
        );
        return result;
    }
    function sendSoapRequest(cmd, bodyContent, SOAPAction) {
        var headers = {'Content-Type': ['text/xml; charset=utf-8']};
        if (SOAPAction) {
            headers.SOAPAction = [SOAPAction];
        }
        var url =  server +  urlDictionary[cmd];
        var result = http(
            url,
            {
                Method: methodDictionary[cmd],
                Headers: headers,
                Body: bodyContent
            },
            params.insecure,
            params.proxy
        );
        if (result.StatusCode < 200 || result.StatusCode >= 300) {
            throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
        }
        return result.Body;
    }
    function getRecordSendSoapRequest(cmd, applicationId, contentId, token) {
        var currentToken = token;
        for(var i = 0; i<10; i++){
            var soap = getContentSoapRequest(currentToken, applicationId, contentId);
            var SOAPAction = 'http://archer-tech.com/webservices/GetRecordById';
            var result = soapRequestSender(cmd, soap, SOAPAction);
            if (result.StatusCode < 200 || result.StatusCode >= 300) {
                if (result.StatusCode === 500 || result.StatusCode === -1){ // unauthorized, try again
                    currentToken = reLogin(currentToken);
                    continue;
                }
                throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
            }
            return result.Body;
        }
    }
    function sendRestRequest(cmd, bodyContent, token, httpTunneling, queryParams) {
        var headers = {
            'Content-Type': ['application/json'],
            'Accept': ['application/json']
        };
        if(httpTunneling) {
            headers['X-Http-Method-Override'] = ['GET'];
        }
        var url = server + replaceInTemplatesAndRemove(urlDictionary[cmd], args);
        if (queryParams) {
            url += queryParams;
        }
        var body = JSON.stringify(bodyContent);
        var currentToken = token;
        for(i = 0; i<10; i++){
            if (currentToken) {
                headers.Authorization = ['Archer session-id=' + currentToken];
            }
            var result = http(
                url,
                {
                    Method: methodDictionary[cmd],
                    Headers: headers,
                    Body: body ? body : ''
                },
                params.insecure,
                params.proxy
            );
            if (result.StatusCode < 200 || result.StatusCode >= 300) {
                if (result.StatusCode === 401 || result.StatusCode === -1){ // unauthorized, try again
                    currentToken = reLogin(currentToken);
                    continue;
                }
                throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
            }
            return JSON.parse(result.Body);
        }
    }

    function searchSendSoapRequest(cmd, token, appId, fields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, sortByFieldId, isDescending, numericOperator, dateOperator, pageNumber) {
        var currentToken = token;
        for(var i = 0; i<10; i++){
            var soap = getContentsByAppIdRequest(currentToken, appId, fields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, sortByFieldId, fieldIdToSearchOn, isDescending, numericOperator, dateOperator, pageNumber);
            var SOAPAction = 'http://archer-tech.com/webservices/ExecuteSearch';
            var result = soapRequestSender(cmd, soap, SOAPAction);
            if (result.StatusCode < 200 || result.StatusCode >= 300) {
                if (result.StatusCode === 500){ // unauthorized, try again
                    currentToken = reLogin(currentToken);
                    continue;
                }
                throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
            }
            return result.Body;
        }
    }
    function createUserSessionFromInstanceSoapRequest(instanceName, userName, password) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '  <soap:Body>' +
        '    <CreateUserSessionFromInstance xmlns="http://archer-tech.com/webservices/">' +
        '      <userName>' + userName + '</userName>' +
        '      <instanceName>' + instanceName + '</instanceName>' +
        '      <password>' + password + '</password>' +
        '    </CreateUserSessionFromInstance>' +
        '  </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function terminateSessionSoapRequest(token) {
        return(
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '    <soap:Body>' +
        '        <TerminateSession xmlns="http://archer-tech.com/webservices/">' +
        '        <sessionToken>' + token + '</sessionToken>' +
        '        </TerminateSession>' +
        '    </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function getContentsByAppIdRequest(token, appId, displayFields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, sortByFieldId, isDescending, numericOperator, dateOperator, pageNumber) {
        var readyMaxReults = (maxResults === undefined || maxResults === null) ? '100' : maxResults;
        return (
        '<?xml version="1.0" encoding="UTF-8"?>' +
        '<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">' +
        '   <soap:Body>' +
        '       <ExecuteSearch xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <searchOptions>' +
        '               <![CDATA[' +
        '                   <SearchReport>' +
        '                       <PageSize>' + readyMaxReults + '</PageSize>' +
        '                       <PageNumber>' + pageNumber + '</PageNumber>' +
        '                       <MaxRecordCount>' + (readyMaxReults || '1') + '</MaxRecordCount>' +
        '                       <ShowStatSummaries>false</ShowStatSummaries>' +
        '                       <DisplayFields>' + displayFields + '</DisplayFields>' +
        '                       <Criteria>' +
        '                           <ModuleCriteria>' +
        '                               <Module name="appname">' + appId + '</Module>' +
        '                           </ModuleCriteria>' +
                                    (fieldIdToSearchOn ?
        '                           <Filter>' +
        '                               <Conditions>' +
                                            (dateOperator ?
        '                                   <DateComparisonFilterCondition>' +
        '                                       <Operator>' + dateOperator + '</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                       <TimeZoneId>UTC Standard Time</TimeZoneId>' +
        '                                       <IsTimeIncluded>TRUE</IsTimeIncluded>' +
        '                                   </DateComparisonFilterCondition>' : '') +
                                            ((!dateOperator && numericOperator) ?
        '                                   <NumericFilterCondition>' +
        '                                       <Operator>' + numericOperator + '</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                   </NumericFilterCondition>' : '') +
                                            ((!dateOperator && !numericOperator) ?
        '                                   <TextFilterCondition>' +
        '                                       <Operator>Contains</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                   </TextFilterCondition>' : '') +
        '                               </Conditions>' +
        '                           </Filter>'
                                    : '') +
                                    (sortByFieldId ?
        '                           <SortFields>' +
        '                               <SortField>' +
        '                                   <Field>' + sortByFieldId + '</Field>' +
        '                                   <SortType>' + (isDescending ? 'Descending' : 'Ascending') + '</SortType>' +
        '                               </SortField>' +
        '                           </SortFields>'
                                    : '') +
        '                       </Criteria>' +
        '                   </SearchReport>' +
        '               ]]>' +
        '           </searchOptions>' +
        '           <pageNumber>1</pageNumber>' +
        '       </ExecuteSearch>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function createContentSoapRequest(token, appId, fields) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema- instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <CreateRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <fieldValues> ' +
        '               <![CDATA[ ' +
        '                   <Record>' + fields + '</Record>' +
        '                ]]>' +
        '           </fieldValues>' +
        '       </CreateRecord>' +
        '   </soap:Body> ' +
        '</soap:Envelope>'
        );
    }
    function updateContentSoapRequest(token, appId, contentId, fields) {
        return (
        '<?xml version="1.0" encoding="utf-8"?> ' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <UpdateRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId +'</contentId>' +
        '           <fieldValues>' +
        '               <![CDATA[' +
        '                   <UpdateRecord>' + fields + '</UpdateRecord>' +
        '               ]]>' +
        '           </fieldValues>' +
        '       </UpdateRecord>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function getContentSoapRequest(token, appId, contentId) {
        return (
        '<?xml version="1.0" encoding="utf-8"?> ' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <GetRecordById xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId +'</contentId>' +
        '       </GetRecordById>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function deleteContentSoapRequest(token, appId, contentId) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <DeleteRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId + '</contentId>' +
        '       </DeleteRecord>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function getValueListForFieldSoapRequest(token, fieldID){
        return (
        '<?xml version="1.0" encoding="utf-8"?>'+
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+
            '<soap:Body>'+
                '<GetValueListForField xmlns="http://archer-tech.com/webservices/">'+
                    '<sessionToken>'+token+'</sessionToken>'+
                    '<fieldId>'+fieldID+'</fieldId>'+
                '</GetValueListForField>'+
            '</soap:Body>'+
        '</soap:Envelope>'
        );
    }
    function getReportsSoapRequest(token){
        return (
        '<?xml version="1.0" encoding="utf-8"?>'+
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+
            '<soap:Body>'+
                '<GetReports xmlns="http://archer-tech.com/webservices/">'+
                    '<sessionToken>'+token+'</sessionToken>'+
                '</GetReports>'+
            '</soap:Body>'+
        '</soap:Envelope>'
        );
    }
    function executeStatisticSearchByReportSoapRequest(token, reportGuid, maxResults) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '  <soap:Body>' +
        '    <ExecuteStatisticSearchByReport xmlns="http://archer-tech.com/webservices/">' +
        '      <sessionToken>' + token + '</sessionToken>' +
        '      <reportIdOrGuid>' + reportGuid + '</reportIdOrGuid>' +
        '      <pageNumber>' + maxResults + '</pageNumber>' +
        '    </ExecuteStatisticSearchByReport>' +
        '  </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function getSearchOptionsByGuidSoapRequest(token, reportGuid) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '  <soap:Body>' +
        '    <GetSearchOptionsByGuid xmlns="http://archer-tech.com/webservices/">' +
        '      <sessionToken>' + token + '</sessionToken>' +
        '      <searchReportGuid>' + reportGuid + '</searchReportGuid>' +
        '    </GetSearchOptionsByGuid>' +
        '  </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function searchRecordsByReportSoapRequest(token, reportGuid, maxResults) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '  <soap:Body>' +
        '    <SearchRecordsByReport xmlns="http://archer-tech.com/webservices/">' +
        '      <sessionToken>' + token + '</sessionToken>' +
        '      <reportIdOrGuid>' + reportGuid + '</reportIdOrGuid>' +
        '      <pageNumber>' + maxResults + '</pageNumber>' +
        '    </SearchRecordsByReport>' +
        '  </soap:Body>' +
        '</soap:Envelope>'
        );
    }
    function getLevelsByApplicationId(token) {
        var lvlResponse = sendRestRequest('levelIdByModuleId', '', token, true);
        return dq(lvlResponse, 'RequestedObject.Id');
    }
    function createMappingFieldIdToName(levels, token) {
        var mapping = {};
        if (!levels) {
            throw 'Mapping levels to Fields failed';
        }
        if (!Array.isArray(levels)) {
            levels = [levels];
        }
        levels.forEach(function (lvl) {
            args.levelId = lvl;
            var fieldsLevelInfo = sendRestRequest('fieldByLevelId', '' ,token, true);
            if (!Array.isArray(fieldsLevelInfo)) {
               fieldsLevelInfo = [fieldsLevelInfo];
            }
            fieldsLevelInfo.forEach(function (field) {
                if (field.RequestedObject.Type !== 25) {
                    mapping[field.RequestedObject.Id] = {
                        Type: field.RequestedObject.Type,
                        Name: field.RequestedObject.Name,
                        levelId: lvl
                    };
                }
            });
        });
        return mapping;
    }
    function createMappingNameToFieldId(levels, token) {
        var mapping = {};
        if (!levels) {
            throw 'Mapping levels to Fields failed';
        }
        if (!Array.isArray(levels)) {
            levels = [levels];
        }
        levels.forEach(function (lvl) {
            args.levelId = lvl;
            var fieldsLevelInfo = sendRestRequest('fieldByLevelId', '', token, true);
            if (!Array.isArray(fieldsLevelInfo)) {
                fieldsLevelInfo = [fieldsLevelInfo];
            }
            fieldsLevelInfo.forEach(function (field) {
                if (field.RequestedObject.Type !== 25) {
                    mapping[field.RequestedObject.Name] = {
                        Type: field.RequestedObject.Type,
                        Id: field.RequestedObject.Id,
                        levelId: lvl
                    };
                }
            });
        });
        return mapping;
    }
    function mapContentFieldNameToValue(mapping, fields, applicationId) {
        // we have records who are linked to the record we are working on.
        // humanReadableTables will have the data related to the linked records
        // recordVals will have the data related to the work record, and brief summary of the linked records
        var recordVals = [];
        var innerRecordsArray = [];
        var mapping = mapping;
        if (fields) {
            var humanReadableTables = [];
            fields.forEach(function (field) {
                var groupValue
                if (field.Groups) { // handling the nested Groups field
                    var group = field.Groups.Group;
                    if (group) {
                        group = varifyOrMakeArray(group);
                        group.forEach(function (gr) {
                            groupValue = groupValue ? groupValue + ',' + gr['-name'] : gr['-name']
                        })
                    }
                }
                // used later on to check if we need to bring more mappings
                var seenModuleIds = {};
                seenModuleIds[applicationId] = applicationId;
                // innerRecordrows and innerRecordcolumns are used to create the human readable
                var innerRecordrows = [];
                if (field.Record) { // handling the nested Record field
                    var innerRecords = varifyOrMakeArray(field.Record);
                    var tableName = mapping[field['-id']].Name;
                    var innerRecordcolumns = [];
                    innerRecords.forEach(function(innerRecord){
                    // iterating over the inner records and creating an row Object for each of them
                        if(innerRecord){
                            var row = {};
                            recordFields = varifyOrMakeArray(innerRecord['Field']);
                            innerRecordcolumns.push('ModuleId');
                            var newModuleId;
                            if(innerRecord['-moduleId']){ // means that it is a linked record from another module
                                newModuleId = innerRecord['-moduleId'];
                                args.applicationId = newModuleId;
                                if (!(newModuleId in seenModuleIds)){ // checking if we need to bring more mappings
                                    var newMapping = createMapping(token);
                                    for (var attrname in newMapping) { mapping[attrname] = newMapping[attrname]; }
                                    seenModuleIds[newModuleId] = newModuleId;
                                }
                            }
                            row['ModuleId'] = newModuleId || applicationId;
                            var innerRecordObject = {'ModuleId': row['ModuleId'],'contentId':innerRecord['-id']};
                            if (innerRecordsArray.indexOf(innerRecordObject) === -1){
                                innerRecordsArray.push (innerRecordObject);
                            }
                            recordFields.forEach(function (f){
                                // building the columns of the human readable
                                if (mapping[f['-id']] && innerRecordcolumns.indexOf(mapping[f['-id']].Name) === -1){
                                    innerRecordcolumns.push(mapping[f['-id']].Name);
                                }
                                // building a row
                                var rowValue = f['-value'] || " ";
                                if(mapping[f['-id']] && mapping[f['-id']].Name){
                                    row[mapping[f['-id']].Name] = rowValue;
                                }
                            });
                            innerRecordrows.push(row);
                        }
                    });
                    humanReadableTables.push([tableName, innerRecordcolumns, innerRecordrows]);
                }
                // if there are no items in innerRecordrows we set it to null to ensure that the contexts would have null and not []
                if (innerRecordrows === undefined || innerRecordrows.length === 0){
                    innerRecordrows = null;
                }
                recordVals.push({
                    FieldId: field['-id'],
                    FieldName: mapping[field['-id']].Name,
                    FieldType: field['-type'],
                    Value: groupValue || field['-value'] || innerRecordrows,
                    LevelId: field['-id']
                });
            });
            recordVals.push({
                FieldName: 'innerRecords',
                Value: innerRecordsArray,
                FieldId: " ",
                LevelId: " ",
                FieldType: " "
            });
        }
        return [recordVals, humanReadableTables];
    }
    function varifyOrMakeArray(arr){
        return Array.isArray(arr)? arr : [arr];
    }
    function createContentContext (recordId, records) {
        var context = {};
        var fields = {};
        records.forEach(function (r) {
            fields[r.FieldName] = r.Value;
        });
        context.Id = recordId;
        context.Fields = fields;
        return context;
    }
    function createKeyValsForFetch (recordId, records) {
        var keyVals = {};
        records.forEach(function (r) {
            keyVals[r.FieldName] = r.Value;
        });
        keyVals.recordId = recordId;
        return keyVals;
    }
    function getAppFields(token) {
        var applicationId = args.applicationId;
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingFieldIdToName(levels, token);
        var md = [];
        for (var fieldId in mapping) {
            md.push({
                FieldId: fieldId,
                FieldName: mapping[fieldId].Name,
                FieldType: mapping[fieldId].Type,
                LevelId: mapping[fieldId].levelId
            })
        }
        return {
            Type: entryTypes.note,
            Contents: mapping,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown
        };
    }
    function createMapping(token){
        var levels = getLevelsByApplicationId(token);
        return createMappingFieldIdToName(levels, token);
    }
    function getRecord(command, token, mapping, contentId, applicationId) {
        var contentId = contentId || args.contentId;
        var applicationId = applicationId || args.applicationId;
        var mapping = mapping || createMapping(token);
        var rawResponse = getRecordSendSoapRequest(command, applicationId, contentId, token);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.GetRecordByIdResponse.GetRecordByIdResult');
        var contentMapping = mapContentFieldNameToValue(mapping, parsedJSON.Record.Field, applicationId);
        var nameToValue = contentMapping[0];
        var innerRecordValues =  contentMapping[1];
        var innerRecordsMarkdown = createInnerRecordsHumanReadable(innerRecordValues);
        var keyValsForFetch = createKeyValsForFetch(contentId, nameToValue);
        return {
            Type: entryTypes.note,
            Contents: parsedJSON,
            keyValsForFetch: keyValsForFetch,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: tableToMarkdown(command, nameToValue) + '\n\n' + innerRecordsMarkdown,
            EntryContext: {
              'Archer.Content(true)': createContentContext(contentId, nameToValue)
            }
        };
    }
    function createInnerRecordsHumanReadable(tables){
        var markdown = "";
        tables.forEach(function (table){
            markdown += tableToMarkdown(table[0], table[2], table[1]);
        })
        return markdown;
    }
    function getListOfApplications(command, token) {
        var body = '';
        var applicatInfo = [];
        var queryParams = '';
        if (args.findByName !== undefined) {
            body = { Value: "?$filter=Name eq '" + args.findByName + "'" };
        } else if (args.findById) {
            queryParams = '/' + args.findById;
        }
        var applictions = sendRestRequest(command, body, token, true, queryParams)
        if (!Array.isArray(applictions)) {
            applictions = [applictions];
        }
        applictions.forEach(function (app) {
            var record = app.RequestedObject;
            if (record) {
                applicatInfo.push({
                    Type: record.Type,
                    LanguageId: record.LanguageId,
                    Id: record.Id,
                    Name: record.Name,
                    Guid: record.Guid,
                    Status: record.Status
                })
            }
        });
        return {
            Type: entryTypes.note,
            Contents: applicatInfo,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, applicatInfo),
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Applications': applicatInfo}
        };
    }
    function inputToXML(fieldsToValue, mapping, token){
        var fields = '';
        for (var key in fieldsToValue) {
            if (mapping[key] !== undefined) {
                switch(mapping[key].Type){
                    case 1:
                    case 2:
                    case 3:
                    case 19:
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key] + '" />';
                        break;
                    case 9:
                    case 18:
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key][0] +'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+fieldsToValue[key][i]+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 4:
                        //fieldsToValue[key] is of the form [value1, value2,...]
                        listValueIdtoName = getValueListForField(commands.valueListForField, token ,{fieldID : mapping[key].Id});
                        fields += '<Field id="' + mapping[key].Id +'" value="' + listValueIdtoName[fieldsToValue[key][0]] +'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+listValueIdtoName[fieldsToValue[key][i]]+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 7:
                        //fieldsToValue[key] is of the form [{value: ___ , link: ___}, {value: ___ , link: ___}, ...]
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key][0].value + '" link="'+fieldsToValue[key][0].link+'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+fieldsToValue[key][i].value+'" link="'+fieldsToValue[key][i].link+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 8:
                    case 15:
                        //fieldsToValue[key] is of the form {groups: [group1, group2,...], users : [user1, user2,...]}
                        fields+= '<Field id="' + mapping[key].Id + '" >';
                        groups = fieldsToValue[key].groups;
                        users = fieldsToValue[key].users;
                        if(groups && Array.isArray(groups) && groups.length > 0){
                            fields += '<Groups>';
                            for(var i=0; i<groups.length; i++){
                                fields += '<Group id="' + groups[i] + '" />';
                            }
                            fields += '</Groups>'
                        }
                        if(users && Array.isArray(users) && users.length > 0){
                            fields += '<Users>';
                            for(var i=0; i<users.length; i++){
                                fields += '<User id="' + users[i] + '" />';
                            }
                            fields += '</Users>'
                        }
                        fields+='</Field>';
                        break;
                    //case 14, 16 : not supported yet
                }
            }
        }
        return fields;
    }
    function createRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var fieldsToValue = JSON.parse(dataArgs.fieldsToValues);
        if (fieldsToValue === null || typeof fieldsToValue !== 'object') {
            throw 'Invalid Argument fieldToValue';
        }
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var fields = inputToXML(fieldsToValue, mapping, token);
        var soap = createContentSoapRequest(token, appId, fields);
        var SOAPAction = 'http://archer-tech.com/webservices/CreateRecord';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var contentId = dq(response, 'Envelope.Body.CreateRecordResponse.CreateRecordResult');
        var md = fieldsToValue;
        md.Id = contentId;
        if (!contentId) {
            return {
                ContentsFormat: formats["markdown"],
                Type: entryTypes["error"],
                Contents: "Recived an error" + JSON.stringify(response)
            };
        }
        return {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Content(true)': {Id: contentId , Fields: fieldsToValue}}
        };
    }
    function updateRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var contentId = dataArgs.contentId;
        var fieldsToValue = JSON.parse(dataArgs.fieldsToValues);
        if (fieldsToValue === null || typeof fieldsToValue !== 'object') {
            throw 'Invalid Argument fieldToValue';
        }
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var fields = inputToXML(fieldsToValue, mapping, token);
        var soap = updateContentSoapRequest(token,appId,contentId,fields);
        var SOAPAction = 'http://archer-tech.com/webservices/UpdateRecord';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var result = dq(response, 'Envelope.Body.UpdateRecordResponse.UpdateRecordResult');
        if (!result && result < 1) {
            return {
                ContentsFormat: formats["markdown"],
                Type: entryTypes["error"],
                Contents: "Recived an error" + JSON.stringify(response)
            };
        }
        return {
            Type: entryTypes.note,
            ContentsFormat: formats.json,
            Contents: response,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: 'content id = ' + contentId + ' was updated successfully'
        }
    }
    function getValueListForField(command, token, dataArgs){
        var SOAPAction = 'http://archer-tech.com/webservices/GetValueListForField';
        var fieldID = dataArgs.fieldID;
        var soap = getValueListForFieldSoapRequest(token, fieldID);
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));
        var result = dq(response, 'Envelope.Body.GetValueListForFieldResponse.GetValueListForFieldResult');
        result = dq(JSON.parse(x2j(result)), 'SelectDef.SelectDefValues.SelectDefValue(true)={Name: val.Name, Id : val.Id}');
        var ret = {};
        for(key in result){
            ret[result[key]['Name']] = result[key]['Id'];
        }
        return ret;
    }
    function getValueObjectForFieldId(token, dataArgs){
        var fieldID = dataArgs.fieldID;
        var mapping = createMapping(token);
        var result = mapping[fieldID];
        try {
            result.FieldId = fieldID;
        } catch (e){
            //no match for this fieldID
        }
        return result;
    }
    function deleteRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var contentId = dataArgs.contentId;
        var soap =  deleteContentSoapRequest(token, appId, contentId);
        var SOAPAction = 'http://archer-tech.com/webservices/DeleteRecord';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var result = dq(response, 'Envelope.Body.DeleteRecordResponse.DeleteRecordResult');
        if (!result && result < 1) {
            return {
                ContentsFormat: formats.markdown,
                Type: entryTypes.error,
                Contents: "Recived an error while deleting record: " + JSON.stringify(response)
            };
        }
        return {
            Type: entryTypes.note,
            Contents: 'content id = ' + contentId + ' was deleted successfully'
        }
    }
    function searchRecords(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var fieldsToDisplay = dataArgs.fieldsToDisplay;
        var maxResults = dataArgs.maxResults;
        var fieldToSearchOn = dataArgs.fieldToSearchOn;
        var searchValue = dataArgs.searchValue;
        var numericOperator = dataArgs.numericOperator;
        var dateOperator = dataArgs.dateOperator;
        var isDescending = dataArgs.Descending;
        var pageNumber = dataArgs.pageNumber || '1';
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var reversemapping = createMappingFieldIdToName(levels, token);
        var fields = ''
        if (!fieldsToDisplay) {
            fieldsToDisplay = Object.keys(mapping);
        }
        if (fieldsToDisplay && !Array.isArray(fieldsToDisplay)){
            fieldsToDisplay = fieldsToDisplay.split(',');
        }
        if (fieldsToDisplay) {
            fieldsToDisplay.forEach(function (field) {
                if (field && mapping[field] !== undefined) {
                    fields += '<DisplayField name="' + escapeXMLChars(field) +'">' + mapping[field].Id + '</DisplayField>';
                }
            });
        }
        var fieldIdToSearchOn;
        var fieldNameToSearchOn;
        if (fieldToSearchOn) {
            fieldIdToSearchOn = mapping[fieldToSearchOn] ? mapping[fieldToSearchOn].Id : '';
            fieldNameToSearchOn = fieldToSearchOn;
        }
        var rawResponse = searchSendSoapRequest(command, token, appId, fields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, fieldIdToSearchOn, isDescending, numericOperator, dateOperator, pageNumber);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Response = " + rawResponse;
        }
        var output = parseRecordsXml(token, response, reversemapping);
        var md = [];
        output.forEach(function (out) {
            md.push(treeToFlattenObject(out));
        })
        return {
            Type: entryTypes.note,
            Contents: output,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown,
            EntryContext: { 'Archer.Content(true)': output }
        };
    }
    function getReports(command, token) {
        var soap = getReportsSoapRequest(token);
        var SOAPAction = 'http://archer-tech.com/webservices/GetReports';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.GetReportsResponse.GetReportsResult');
        return {
            Type: entryTypes.note,
            Contents: parsedJSON,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Content(true)': parsedJSON}
        };
    }
    function executeStatisticSearchByReport(command, token, dataArgs) {
        var maxResults = dataArgs.maxResults || '100';
        var reportGuid = dataArgs.reportGuid;
        var soap = executeStatisticSearchByReportSoapRequest(token, reportGuid, maxResults);
        var SOAPAction = 'http://archer-tech.com/webservices/ExecuteStatisticSearchByReport';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.ExecuteStatisticSearchByReportResponse.ExecuteStatisticSearchByReportResult');
        return {
            Type: entryTypes.note,
            Contents: parsedJSON,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            EntryContext: { 'Archer.Content(true)': parsedJSON}
        };
    }
    function getSearchOptionsByGuid(command, token, dataArgs) {
        var reportGuid = dataArgs.reportGuid;
        var soap = getSearchOptionsByGuidSoapRequest(token, reportGuid);
        var SOAPAction = 'http://archer-tech.com/webservices/GetSearchOptionsByGuid';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.GetSearchOptionsByGuidResponse.GetSearchOptionsByGuidResult');
        return {
            Type: entryTypes.note,
            Contents: parsedJSON,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            EntryContext: { 'Archer.Content(true)': parsedJSON }
        };
    }
    function searchRecordsByReport(command, token, dataArgs) {
        var maxResults = dataArgs.maxResults || '1';
        var reportGuid = dataArgs.reportGuid;
        var soap = searchRecordsByReportSoapRequest(token, reportGuid, maxResults);
        var SOAPAction = 'http://archer-tech.com/webservices/SearchRecordsByReport';
        var rawResponse = sendSoapRequest(command, soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Error in response. Request = " + soap + " Response = " + rawResponse;
        }
        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.SearchRecordsByReportResponse.SearchRecordsByReportResult');
        return {
            Type: entryTypes.note,
            Contents: parsedJSON,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            EntryContext: { 'Archer.Content(true)': parsedJSON }
        };
    }
    function getOccurredTime(recordTimeStr, tz) {
        var occurred = new Date();
        if (recordTimeStr) {
            var tzHour = tz / 60;
            if (tzHour < 0) {
                tzHour *= -1;
            }
            var tzMinute = tz % 60;
            var tzPrefix = tz < 0 ? '-' : '+';
            var tzHourstr = tzHour + '';
            if (tzHourstr.length < 2) {
                tzHourstr = '0' + tzHourstr;
            }
            var tzMinutestr = tzMinute +'';
            if (tzMinutestr.length < 2) {
                tzMinutestr = '0' + tzMinutestr;
            }
            // convert 7/18/2017 8:17:49 AM to 2017-07-18T20:17:49-0800
            var dateStr = recordTimeStr.split(' ')[0];
            var monthStr = dateStr.split('/')[0];
            var dayStr = dateStr.split('/')[1];
            var yearStr = dateStr.split('/')[2];
            var timeStr = recordTimeStr.split(' ')[1];
            var extStr = recordTimeStr.split(' ')[2];
            var hourInt = Number(timeStr.split(':')[0]);
            var minStr = timeStr.split(':')[1];
            var secStr = timeStr.split(':')[2];
            if (extStr == "PM" && hourInt < 12) {
                hourInt = hourInt + 12;
            }
            if (extStr == "AM" && hourInt == 12) {
                hourInt = hourInt - 12;
            }
            var hourStr = hourInt + '';
            if (Number(hourInt) < 10 && hourStr.length === 1) {
                hourStr = "0" + hourStr;
            }
            if (Number(minStr) < 10 && minStr.length === 1) {
                minStr = "0" + minStr;
            }
            if (Number(dayStr) < 10 && dayStr.length === 1) {
                dayStr = "0" + dayStr;
            }
            if (Number(monthStr) < 10 && monthStr.length === 1) {
                monthStr = "0" + monthStr;
            }
            recordTimeStr = yearStr + '-' +  monthStr + '-' + dayStr + 'T' + hourStr + ':' + minStr + ':' + secStr;
            occurred = new Date(Date.parse(recordTimeStr + tzPrefix + tzHourstr + tzMinutestr));
        }
        return occurred;
    }
    function toDateArcherString(date) {
        var day = Number(date.getDate());
        var month = Number(date.getMonth()) + 1;
        var year = date.getFullYear();
        var hour = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();
        var ext = 'AM';
        var finalHour = hour;
        if (hour > 12) {
            ext = 'PM';
            finalHour = (hour - 12);
            if (finalHour == 12) {
                ext = 'AM';
            }
        } else if (hour < 12) {
            finalHour = hour;
            ext = 'AM';
        } else if (hour == 12) {
            ext = 'PM';
        }
        if (minutes < 10) {
            minutes = '0' + minutes;
        }
        if (seconds < 10) {
            seconds = '0' + seconds;
        }
        // format such: 7/22/2017 3:58 PM
        return month + '/' + day + '/' + year + ' ' + finalHour + ':' + minutes + ':' + seconds + ' ' + ext;
    }
    function fetchIncidents(token, dataArgs) {
        var myTimezone = new Date().getTimezoneOffset() * -1;
        var tz = params.timeZone ? parseInt(params.timeZone) : myTimezone;
        if (params.timeZone === '0') {
            tz = 0;
        }
        var cmd = commands.searchRecords;
        var incidentRes = [];
        var lastRun = getLastRun();
        var day = 60 * 1000 * 60 * 24;
        var lastTime = lastRun.lastTime;
        if (!lastRun.lastTime) {
            lastTime = new Date().getTime() - (day * 1);
        }
        var searchByField = params.fetchByField;
        dataArgs.applicationId = params.fetchApplicationId;
        dataArgs.dateOperator = 'GreaterThan';
        dataArgs.searchValue = toDateArcherString(new Date(lastTime));
        dataArgs.fieldToSearchOn = searchByField;
        dataArgs.fieldsToDisplay = params.fetchFields + ',' + searchByField;
        var incidents = [];
        var results = searchRecords(cmd, token, dataArgs);
        if (results && results.Contents && results.Contents.length > 0) {
            for (var i = 0; i < results.Contents.length; i++) {
                var res = results.Contents[i];
                var labels = [];
                var fields = Object.keys(res.Fields);
                if (fields) {
                    for (var j = 0; j < fields.length; j++) {
                        var fieldName = fields[j];
                        var fieldValue;
                        fieldValue = res.Fields[fieldName];
                        if (fieldName === "Record"){
                            continue;
                        }
                        if (fieldName === "Date Created") {
                            lastTime = getOccurredTime(fieldValue, tz);
                        }
                        labels.push({ 'type': fieldName, 'value': fieldValue });
                    }
                }
                var raw = JSON.stringify(res);
                incidents.push({
                    name: 'RSA Archer Incident: ' + res.Id,
                    labels: labels,
                    details: raw,
                    rawJSON: raw,
                    occurred: lastTime
                });
            }
            var offset = tz ? (60 * 1000 * new Date().getTimezoneOffset()) : 0;
            setLastRun({ lastTime: lastTime.getTime() + offset });
        }
        return (JSON.stringify(incidents));
    }
    function getAuthToken() {
        var soap = createUserSessionFromInstanceSoapRequest(params.instanceName,
                                                            params.credentials.identifier,
                                                            params.credentials.password);
        var SOAPAction = 'http://archer-tech.com/webservices/CreateUserSessionFromInstance';
        var rawResponse = sendSoapRequest('login', soap, SOAPAction);
        var response = JSON.parse(x2j(rawResponse));
        if (typeof rawResponse !== 'string' || rawResponse.length == 0) {
            throw "Login failed. Request = " + soap + " Response = " + rawResponse;
        }
        var token = dq(response, 'Envelope.Body.CreateUserSessionFromInstanceResponse.CreateUserSessionFromInstanceResult');
        return token;
    }
    function destroyAuthToken(token) {
        var soap = terminateSessionSoapRequest(token);
        var SOAPAction = 'http://archer-tech.com/webservices/TerminateSession';
        try {
            sendSoapRequest('logout', soap, SOAPAction);
        } catch(err) {
            if (err.indexOf('Invalid session token') > -1) {
                // it means the session token already expired so no need to be terminated
                return
            }
            throw err
        }
    }
    function reLogin(token){
        destroyAuthToken(token);
        return getAuthToken();
    }
    function test() {
        var isFetch = params.isFetch;
        if (isFetch && !params.fetchApplicationId) {
            throw 'If Fetch incidents is on, then Application Id must be passed';
        }
    }
    var token = null;
    try {
        token = getAuthToken();
        switch (command) {
            case 'test-module':
                test();
                return !!token ? 'ok' : 'not-ok';
            case commands.createRecord:
                return createRecord(command, token, args);
            case commands.valueListForField:
                return getValueObjectForFieldId(token, args);
            case commands.updateRecord:
                return updateRecord(command, token, args);
            case commands.deleteRecord:
                return deleteRecord(command, token, args);
            case commands.getRecord:
                return getRecord(command, token);
            case commands.searchApps:
                return getListOfApplications(command, token);
            case commands.searchRecords:
                return searchRecords(command, token , args);
            case commands.getAppFields:
                return getAppFields(token);
            case commands.fetchIncidents:
                return fetchIncidents(token, args);
            case commands.getReports:
                return getReports(command, token);
            case commands.executeStatisticSearchByReport:
                return executeStatisticSearchByReport(command, token, args);
            case commands.getSearchOptionsByGuid:
                return getSearchOptionsByGuid(command, token, args);
            case commands.searchRecordsByReport:
                return searchRecordsByReport(command, token, args);
            case 'fetch-incidents':
                return fetchIncidents(token, args);
            default:
                break;
        }
    }
    finally {
        destroyAuthToken(token);
    }
  type: javascript
  commands:
  - name: archer-create-record
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to create record in
    - name: fieldsToValues
      required: true
      description: 'Record fields in JSON format: { Name1: Value1, Name2: Value2 }.
        Field name is case sensitive.'
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id
    - contextPath: Archer.Content.Fields
      description: Content property fields
    description: Creates a new content record in the given application.
  - name: archer-update-record
    arguments:
    - name: contentId
      required: true
      description: The Content (record) ID to update
    - name: applicationId
      required: true
      description: ID of the application to update record in
    - name: fieldsToValues
      required: true
      description: 'Record fields in JSON format: { Name1: Value1, Name2: Value2 }.
        Field name is case sensitive.'
    description: Updates existing content record in the given application.
  - name: archer-get-record
    arguments:
    - name: contentId
      required: true
      description: 'The Content (record) ID to get details for (for example: id=12345
        for INC-12345)'
    - name: applicationId
      required: true
      description: ID of the application to get record from
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id of the record
    - contextPath: Archer.Content.Fields
      description: Content property fields
    - contextPath: Archer.Content.Fields.Incident Status
      description: Incident Status
    - contextPath: Archer.Content.Fields.Record Status
      description: Record Status
    - contextPath: Archer.Content.Fields.Last Updated
      description: Last Updated
    - contextPath: Archer.Content.Fields.Days Open
      description: Days Open
    - contextPath: Archer.Content.Fields.Date Created
      description: Date Created
    - contextPath: Archer.Content.Fields.Title
      description: Title
    - contextPath: Archer.Content.Fields.Incident Summary
      description: Incident Summary
    - contextPath: Archer.Content.Fields.Threat Category
      description: Threat Category
    - contextPath: Archer.Content.Fields.Threat Valid
      description: Threat Valid
    description: Gets information about a content record in the given application.
  - name: archer-search-applications
    arguments:
    - name: findByName
      default: true
      description: Get application by name (leave empty to get all applications)
    - name: findById
      description: Get application by ID (leave empty to get all applications)
    outputs:
    - contextPath: Archer.Applications.Id
      description: Application Id
    - contextPath: Archer.Applications.Type
      description: Application Type
    - contextPath: Archer.Applications.Name
      description: Application Name
    - contextPath: Archer.Applications.Status
      description: Application Status
    - contextPath: Archer.Applications.Guid
      description: Unique Id of application
    description: Gets application details or list of all applications.
  - name: archer-search-records
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to search records in
    - name: fieldsToDisplay
      description: 'Fields to present in the search results in array format (for example:
        "Title,Incident Summary")'
      isArray: true
    - name: maxResults
      description: Maximum results to return from the search (default is 100)
      defaultValue: "100"
    - name: searchValue
      description: Search value (leave empty to search for all)
    - name: fieldToSearchOn
      description: Name of field to search on (leave empty to search for all)
    - name: numericOperator
      auto: PREDEFINED
      predefined:
      - Equals
      - NotEqual
      - GreaterThan
      - LessThan
      description: Numeric search operator
    - name: dateOperator
      auto: PREDEFINED
      predefined:
      - Equals
      - DoesNotEqual
      - GreaterThan
      - LessThan
      description: Date search operator
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id
    - contextPath: Archer.Content.ApplicationId
      description: Application Id
    - contextPath: Archer.Content.Fields
      description: Content property fields
    description: Search for records inside the given application
  - name: archer-get-application-fields
    arguments:
    - name: applicationId
      required: true
      default: true
      description: ID of the application to search fields in
    description: Gets all application fields by application ID
  - name: archer-delete-record
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to delete record in
    - name: contentId
      required: true
      description: The Content (record) ID to delete
    description: Delete existing content record in the given application.
  - name: archer-value-list-for-field
    arguments:
    - name: fieldID
      required: true
      description: ID of the field
    - name: applicationId
      required: true
      description: ID of the application to get field value from
    description: Returns mapping from list value name to list value id
  - name: archer-fetch-incidents
    arguments:
    - name: applicationId
      required: true
      default: true
      description: ID of the application to fetch records from
    description: Fetching incidents from Archer
  - name: archer-get-reports
    arguments: []
    description: Gets reports from Archer
  - name: archer-execute-statistic-search-by-report
    arguments:
    - name: reportGuid
      required: true
      description: The GUID of the report
    - name: maxResults
      defaultValue: "100"
      description: Maximum pages of the reports
    description: Performs statistic search by report Guid
  - name: archer-get-search-options-by-guid
    arguments:
    - name: reportGuid
      description: The GUID of the report
      required: true
      description: The GUID of the report
    description: 'Getting search criteria by report GUID '
  - name: archer-search-records-by-report
    arguments:
    - name: reportGuid
      description: The GUID of the report
      required: true
    - name: maxResults
      description: Maximum pages of the records
      defaultValue: "1"
    description: Search records by report Guid
  isfetch: true
releaseNotes: "--"
